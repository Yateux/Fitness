import React from 'react';
import styled from 'styled-components';

// --- Types & Interfaces ---

interface UsageChartProps {
  size?: number;
  strokeWidth?: number;
  percentage?: number;
}

interface StyledProps {
  $size?: number;
  $strokeWidth?: number;
  $color?: string;
  $dashArray?: string;
  $dashOffset?: number;
}

// --- Composants Stylisés ---

const Wrapper = styled.div<StyledProps>`
  display: inline-flex;
  align-items: center;
  gap: ${props => (props.$size ? props.$size / 4 : 8)}px;
  font-family: sans-serif;
`;

const ChartSvg = styled.svg`
  transform: rotate(-90deg);
  display: block;
  flex-shrink: 0;
`;

const ChartCircle = styled.circle<StyledProps>`
  fill: none;
  stroke-width: ${props => props.$strokeWidth}px;
  stroke-linecap: round;
  transition: all 0.3s ease-in-out;
  stroke: ${props => props.$color};
  stroke-dasharray: ${props => props.$dashArray};
  stroke-dashoffset: ${props => props.$dashOffset};
`;

// --- Composant Principal ---

const DynamicUsageChart: React.FC<UsageChartProps> = ({ 
  size = 30, 
  strokeWidth = 4, 
  percentage = 25 
}) => {
  // Calculs de géométrie SVG
  const radius: number = (size - strokeWidth) / 2;
  const circumference: number = 2 * Math.PI * radius;
  const autoGap: number = circumference * 0.05;
  
  const orangeSegment: number = (percentage / 100) * circumference - autoGap;
  const blueSegment: number = ((100 - percentage) / 100) * circumference - autoGap;

  return (
    <Wrapper $size={size}>
      <ChartSvg
        width={size}
        height={size}
        viewBox={`0 0 ${size} ${size}`}
      >
        {/* Segment Bleu */}
        <ChartCircle
          cx={size / 2}
          cy={size / 2}
          r={radius}
          $strokeWidth={strokeWidth}
          $color="#6d8bc4"
          $dashArray={`${blueSegment} ${circumference - blueSegment}`}
          $dashOffset={-( (percentage / 100) * circumference + autoGap / 2 )}
        />

        {/* Segment Orange */}
        <ChartCircle
          cx={size / 2}
          cy={size / 2}
          r={radius}
          $strokeWidth={strokeWidth}
          $color="#f08036"
          $dashArray={`${orangeSegment} ${circumference - orangeSegment}`}
          $dashOffset={-autoGap / 2}
        />
      </ChartSvg>
    </Wrapper>
  );
};

export default DynamicUsageChart;

export default function DocumentationViewer({ data }) {
  useEffect(() => {
    const container = document.getElementById("contentDoc");
    if (!container) return;

    // attendre que le HTML soit bien injecté
    const svgEl = container.querySelector("svg");
    if (!svgEl) return;

    // viewBox initiale (récupère celle du SVG ou crée une base)
    let viewBox = svgEl.viewBox.baseVal || { x: 0, y: 0, width: 1000, height: 1000 };
    let isPanning = false;
    let start = { x: 0, y: 0 };

    // --- Zoom à la molette ---
    svgEl.addEventListener("wheel", (e) => {
      e.preventDefault();
      const zoomFactor = e.deltaY > 0 ? 1.1 : 0.9;
      const mouseX = e.offsetX / svgEl.clientWidth;
      const mouseY = e.offsetY / svgEl.clientHeight;
      viewBox.x += (viewBox.width * (mouseX - mouseX * zoomFactor));
      viewBox.y += (viewBox.height * (mouseY - mouseY * zoomFactor));
      viewBox.width *= zoomFactor;
      viewBox.height *= zoomFactor;
      svgEl.setAttribute(
        "viewBox",
        `${viewBox.x} ${viewBox.y} ${viewBox.width} ${viewBox.height}`
      );
    });

    // --- Pan (drag) ---
    svgEl.addEventListener("mousedown", (e) => {
      isPanning = true;
      start = { x: e.clientX, y: e.clientY };
    });
    svgEl.addEventListener("mousemove", (e) => {
      if (!isPanning) return;
      const dx = (e.clientX - start.x) * (viewBox.width / svgEl.clientWidth);
      const dy = (e.clientY - start.y) * (viewBox.height / svgEl.clientHeight);
      viewBox.x -= dx;
      viewBox.y -= dy;
      svgEl.setAttribute(
        "viewBox",
        `${viewBox.x} ${viewBox.y} ${viewBox.width} ${viewBox.height}`
      );
      start = { x: e.clientX, y: e.clientY };
    });
    svgEl.addEventListener("mouseup", () => (isPanning = false));
    svgEl.addEventListener("mouseleave", () => (isPanning = false));

    // Nettoyage si le composant se démonte
    return () => {
      svgEl.onwheel = svgEl.onmousedown = svgEl.onmousemove = svgEl.onmouseup = null;
    };
  }, [data.text]);

  return (
    <DocContentMiddleText
      id="contentDoc"
      dangerouslySetInnerHTML={{ __html: data.text }}
    />
  );
}
